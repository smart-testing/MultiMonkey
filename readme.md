# Testopithecus

### Как настроить проект

- Открываем проект
- IDEA предлагает заимпортить его как Gradle-проект
- Соглашаемся, в появившимся окне выбираем в качестве `Gradle SDK` хотя бы `Java 1.8`
- Добавляем в корень проекта файл `local.properties`
- Добавляем в него путь до Android SDK, например `sdk.dir=/Users/amosov-f/Library/Android/sdk`

### Как запустить на андроиде

- Перед тем как запускать что-либо на андроиде, складываем все apk, которые хотим протестировать, в `src/androidTest/apks/` и запустить команду `gradle putTestedApks`
- Открываем файл `SimpleUITest.kt` и запускаем метод:
    * `testApplication()` чтобы запустить обычный манки
    * `calculateMetrics()` чтобы вычислить метрики (количество падений, количество шагов до первого падения, итд)
    * `takeScreenshot()` чтобы снять скриншот и отправить на сервер
    * `restoreActions()` чтобы манки по логам восстановил экшены
    * `replayTest()` чтобы воспроизвести список экшенов

### Как записать действия, восcоздать экшены' и запустить регресс
* Подготовка
    - Складываем apk, который хотим протестировать, в `src/androidTest/apks/`
    - Выполняем в терминале команду `gradle putTestedApks`
    - Запускаем сервер командой `cd http-server && gradle run`
    - Открываем файл `SimpleUITest.kt`
    - Записываем package приложения в поле `DEFAULT_PACKAGE`
    - Записываем имя apk в поле `DEFAULT_APK`
* Запись действий
    - Запускаем приложение и совершаем действия
    - Чтобы после очередного действия снять скриншот, запускаем метод `takeScreenshot()`
    - После окончания записи действий копируем содержимое файла http-server/log/common.log в http-server/log/<test_name>.log
* Воссоздание списка экшенов
    - В методе `restoreActions()` меняем последний параметр вызова `runMonkey()` на `"<test_name>"`
    - Запускаем `restoreActions()`
    - Воссозданные экшены будут лежать в `http-server/tests/<test_name>.monkey`
* Запуск теста
    - В методе `replayTest()` меняем последний параметр вызова `runMonkey()` на `"<test_name>"`
    - Запускаем `replayTest()`
    - Если тест зеленый, всё ОК
    - Иначе ищем в logcat логи с тегом `MONKEY`